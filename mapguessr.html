<html>
  <head>
    <meta charset="utf-8">
    <title>MapGuessr</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.7.0/mapbox-gl.js"></script>
    <script src="https://unpkg.com/h3-js@3.7.2/dist/h3-js.umd.js"></script>
    <script src="https://unpkg.com/deck.gl@^8.0.0/dist.min.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.4.0/mapbox-gl.js"></script>

    <style type="text/css">
      body {
        font-family: Helvetica, Arial, sans-serif;
        width: 100vw;
        height: 100vh;
        margin: 0;
      }
      #control-panel {
        position: absolute;
        top: 0;
        left: 0;
        margin: 12px;
        padding-left: 20px;
        padding-right: 20px;
        font-size: 12px;
        line-height: 1.5;
        z-index: 1;
        
        font-family: Helvetica, Arial, sans-serif;
        /* box-shadow: 0 0 4px rgba(0, 0, 0, 0.15); */
        max-width: 310px;
      }
      
      #wrapper {
  position: absolute;
  top: 0;
  left: 0;
  width: 210px;
  height: 190;
  padding-top: 0px;
  overflow: hidden;
  transition: height 0.5s, padding-top 0s 0.5s;
  transition: width 0.5s, padding-left 0s 0.5s;
  
}
#control-panel:hover{
    background-color:rgba(255, 255, 255, 1);
}

#wrapper:hover {
 
  width: 350px;
  height: 780px;
  padding-top: 0;
  transition: height 0.5s, padding-top 0.5s;
  transition: width 0.5s,  padding-left 0.5s;
  
}
      label {
        display: inline-block;
        width: 140px;
      }
      .base-timer {
  position: relative;
  width: 150px;
  height: 150px;
}

.base-timer__svg {
  transform: scaleX(-1);
}

.base-timer__circle {
  fill: none;
  stroke: none;
}

.base-timer__path-elapsed {
  stroke-width: 7px;
  stroke: grey;
}

.base-timer__path-remaining {
  stroke-width: 7px;
  stroke-linecap: round;
  transform: rotate(90deg);
  transform-origin: center;
  transition: 1s linear all;
  fill-rule: nonzero;
  stroke: currentColor;
}

.base-timer__path-remaining.green {
  color: rgb(65, 184, 131);
}

.base-timer__path-remaining.orange {
  color: orange;
}

.base-timer__path-remaining.red {
  color: red;
}

.base-timer__label {
  position: absolute;
  width: 150px;
  height: 150px;
  top: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
}
#arrow{
    position: relative;
    display: block;
    left: 65;
}
.toprightcorner{ position: absolute;
        top: 0;
        right: 0;
        margin: 12px;
        padding-left: 0px;
        padding-right: 0px;
        font-size: 12px;
        line-height: 1.5;
        z-index: 1;
        
        font-family: Helvetica, Arial, sans-serif;
        /* box-shadow: 0 0 4px rgba(0, 0, 0, 0.15); */
        }

        #share{
            display:inline-block;
            padding:0.4em 3.7em;
            /* margin:0 0.3em 0.3em 0; */
            /* border-radius:0.15em; */
            /* box-sizing: border-box; */
            text-decoration:none;
            font-family:'Roboto',sans-serif;
            /* text-transform:uppercase; */
            font-weight:400;
            color:#FFFFFF;
            background-color:#1a967b;
            /* box-shadow:inset 0 -0.6em 0 -0.35em rgba(0,0,0,0.17); */
            text-align:center;
            position:relative;
            }
            #share:active{
            top:0.1em;
            }

            .loader,
        .loader:after {
            border-radius: 50%;
            width: 10em;
            height: 10em;
        }
        .loader {            
            margin: 300px auto;
            font-size: 10px;
            position: relative;
            text-indent: -9999em;
            border-top: 1.1em solid rgba(255, 255, 255, 0.2);
            border-right: 1.1em solid rgba(255, 255, 255, 0.2);
            border-bottom: 1.1em solid rgba(255, 255, 255, 0.2);
            border-left: 1.1em solid #000000;
            -webkit-transform: translateZ(0);
            -ms-transform: translateZ(0);
            transform: translateZ(0);
            -webkit-animation: load8 1.1s infinite linear;
            animation: load8 1.1s infinite linear;
        }
        @-webkit-keyframes load8 {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }
        @keyframes load8 {
            0% {
                -webkit-transform: rotate(0deg);
                transform: rotate(0deg);
            }
            100% {
                -webkit-transform: rotate(360deg);
                transform: rotate(360deg);
            }
        }
        #loadingDiv {
            position:absolute;;
            top:0;
            left:0;
            width:100%;
            height:100%;
            background-color:rgb(250, 249, 249);
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  </head>
  <body id="body">
    <script>
    $('body').append('<div style="" id="loadingDiv"><div class="loader"></div></div>');
    $(window).on('load', function(){
        setTimeout(removeLoader, 1000); //wait for page load PLUS one second.
      });
      function removeLoader(){
          $( "#loadingDiv" ).fadeOut(200, function() {
            // fadeOut complete. Remove the loading div
            $( "#loadingDiv" ).remove(); //makes page more lightweight 
        });  
      }
      </script>

    <div id="logobox" class="toprightcorner">
      <a href="https://www.bonfire.com/mapguessr-merchandise/"><img id="logo" src="MapGuessr-logos/MapGuessr-logos_transparent.png" width="120" height="120"></a>
      <br>
      <!-- <a href="#" onclick="replaceString()"><button id= 'share'>Share</button></a> -->
      <button id= 'share'>Share</button>
      

    </div>
    <div id="wrapper">
        <div id="control-panel">
            <div id="app"></div>
            <img id="arrow" src="arrow.png" width="20" height="20">
            <br>
            <div>
                <input id="reset" type="button" value="Reset to Original Map View"></input>
            </div>
            <br>
            <div>
            <label>Game Mode</label>
            <select id="hard" name="hard">
                <option value=11.1>Daily Challenge</option>
                <option value=11>Easy</option>
                <option value=14>Medium</option>
                <option value=16>Hard</option>
                <option value=18>Very Hard</option>
                <option value=19>Expert</option>
                
                <!-- <option value=20>Street Mode (Beta)</option>
                <option value=11.1>Easy Multiplayer (Beta)</option>
                <option value=14.1>Medium Multiplayer (Beta)</option>
                <option value=16.1>Hard Multiplayer (Beta)</option>
                <option value=18.1>Very Hard Multiplayer (Beta)</option>
                <option value=19.1>Expert Multiplayer (Beta)</option> -->
            </select>       
            </div>
            <br>
            <div>
            <label id="movelabel">Movement</label>
            <select id="move" name="move">
                <option value=1>Pan and Zoom</option>
                <option value=2>Pan Only</option>
                <option value=3>Zoom Only</option>
            </select>       
            </div>
            <br>   
            <div>
            <label>Guess</label>
            <select id="guess" name="guess">
                <option value="AF">Afghanistan</option>
                <option value="AX">Aland Islands</option>
                <option value="AL">Albania</option>
                <option value="DZ">Algeria</option>
                <option value="AS">American Samoa</option>
                <option value="AD">Andorra</option>
                <option value="AO">Angola</option>
                <option value="AI">Anguilla</option>
                <option value="AQ">Antarctica</option>
                <option value="AG">Antigua and Barbuda</option>
                <option value="AR">Argentina</option>
                <option value="AM">Armenia</option>
                <option value="AW">Aruba</option>
                <option value="AU">Australia</option>
                <option value="AT">Austria</option>
                <option value="AZ">Azerbaijan</option>
                <option value="BS">Bahamas</option>
                <option value="BH">Bahrain</option>
                <option value="BD">Bangladesh</option>
                <option value="BB">Barbados</option>
                <option value="BY">Belarus</option>
                <option value="BE">Belgium</option>
                <option value="BZ">Belize</option>
                <option value="BJ">Benin</option>
                <option value="BM">Bermuda</option>
                <option value="BT">Bhutan</option>
                <option value="BO">Bolivia</option>
                <option value="BQ">Bonaire</option>
                <option value="BA">Bosnia and Herzegovina</option>
                <option value="BW">Botswana</option>
                <option value="BV">Bouvet Island</option>
                <option value="BR">Brazil</option>
                <option value="IO">British Indian Ocean Territory</option>
                <option value="BN">Brunei Darussalam</option>
                <option value="BG">Bulgaria</option>
                <option value="BF">Burkina Faso</option>
                <option value="BI">Burundi</option>
                <option value="KH">Cambodia</option>
                <option value="CM">Cameroon</option>
                <option value="CA">Canada</option>
                <option value="CV">Cape Verde</option>
                <option value="KY">Cayman Islands</option>
                <option value="CF">Central African Republic</option>
                <option value="TD">Chad</option>
                <option value="CL">Chile</option>
                <option value="CN">China</option>
                <option value="CX">Christmas Island</option>
                <option value="CC">Cocos (Keeling) Islands</option>
                <option value="CO">Colombia</option>
                <option value="KM">Comoros</option>
                <option value="CG">Congo</option>
                <option value="CD">Democratic Republic of the Congo</option>
                <option value="CK">Cook Islands</option>
                <option value="CR">Costa Rica</option>
                <option value="CI">Cote D'Ivoire</option>
                <option value="HR">Croatia</option>
                <option value="CU">Cuba</option>
                <option value="CW">Curacao</option>
                <option value="CY">Cyprus</option>
                <option value="CZ">Czech Republic</option>
                <option value="DK">Denmark</option>
                <option value="DJ">Djibouti</option>
                <option value="DM">Dominica</option>
                <option value="DO">Dominican Republic</option>
                <option value="EC">Ecuador</option>
                <option value="EG">Egypt</option>
                <option value="SV">El Salvador</option>
                <option value="GQ">Equatorial Guinea</option>
                <option value="ER">Eritrea</option>
                <option value="EE">Estonia</option>
                <option value="ET">Ethiopia</option>
                <option value="FK">Falkland Islands (Malvinas)</option>
                <option value="FO">Faroe Islands</option>
                <option value="FJ">Fiji</option>
                <option value="FI">Finland</option>
                <option value="FR">France</option>
                <option value="GF">French Guiana</option>
                <option value="PF">French Polynesia</option>
                <option value="TF">French Southern Territories</option>
                <option value="GA">Gabon</option>
                <option value="GM">Gambia</option>
                <option value="GE">Georgia</option>
                <option value="DE">Germany</option>
                <option value="GH">Ghana</option>
                <option value="GI">Gibraltar</option>
                <option value="GR">Greece</option>
                <option value="GL">Greenland</option>
                <option value="GD">Grenada</option>
                <option value="GP">Guadeloupe</option>
                <option value="GU">Guam</option>
                <option value="GT">Guatemala</option>
                <option value="GG">Guernsey</option>
                <option value="GN">Guinea</option>
                <option value="GW">Guinea-Bissau</option>
                <option value="GY">Guyana</option>
                <option value="HT">Haiti</option>
                <option value="HM">Heard Island and Mcdonald Islands</option>
                <option value="HN">Honduras</option>
                <option value="HK">Hong Kong</option>
                <option value="HU">Hungary</option>
                <option value="IS">Iceland</option>
                <option value="IN">India</option>
                <option value="ID">Indonesia</option>
                <option value="IR">Iran</option>
                <option value="IQ">Iraq</option>
                <option value="IE">Ireland</option>
                <option value="IM">Isle of Man</option>
                <option value="IL">Israel</option>
                <option value="IT">Italy</option>
                <option value="JM">Jamaica</option>
                <option value="JP">Japan</option>
                <option value="JE">Jersey</option>
                <option value="JO">Jordan</option>
                <option value="KZ">Kazakhstan</option>
                <option value="KE">Kenya</option>
                <option value="KI">Kiribati</option>
                <option value="XK">Kosovo</option>
                <option value="KW">Kuwait</option>
                <option value="KG">Kyrgyzstan</option>
                <option value="LA">Laos</option>
                <option value="LV">Latvia</option>
                <option value="LB">Lebanon</option>
                <option value="LS">Lesotho</option>
                <option value="LR">Liberia</option>
                <option value="LY">Libya</option>
                <option value="LI">Liechtenstein</option>
                <option value="LT">Lithuania</option>
                <option value="LU">Luxembourg</option>
                <option value="MO">Macao</option>
                <option value="MK">Macedonia</option>
                <option value="MG">Madagascar</option>
                <option value="MW">Malawi</option>
                <option value="MY">Malaysia</option>
                <option value="MV">Maldives</option>
                <option value="ML">Mali</option>
                <option value="MT">Malta</option>
                <option value="MH">Marshall Islands</option>
                <option value="MQ">Martinique</option>
                <option value="MR">Mauritania</option>
                <option value="MU">Mauritius</option>
                <option value="YT">Mayotte</option>
                <option value="MX">Mexico</option>
                <option value="FM">Micronesia</option>
                <option value="MD">Moldova</option>
                <option value="MC">Monaco</option>
                <option value="MN">Mongolia</option>
                <option value="ME">Montenegro</option>
                <option value="MS">Montserrat</option>
                <option value="MA">Morocco</option>
                <option value="MZ">Mozambique</option>
                <option value="MM">Myanmar</option>
                <option value="NA">Namibia</option>
                <option value="NR">Nauru</option>
                <option value="NP">Nepal</option>
                <option value="NL">Netherlands</option>
                <option value="AN">Netherlands Antilles</option>
                <option value="NC">New Caledonia</option>
                <option value="NZ">New Zealand</option>
                <option value="NI">Nicaragua</option>
                <option value="NE">Niger</option>
                <option value="NG">Nigeria</option>
                <option value="NU">Niue</option>
                <option value="NF">Norfolk Island</option>
                <option value="MP">Northern Mariana Islands</option>
                <option value="KP">North Korea</option>
                <option value="NO">Norway</option>
                <option value="OM">Oman</option>
                <option value="PK">Pakistan</option>
                <option value="PW">Palau</option>
                <option value="PS">Palestine</option>
                <option value="PA">Panama</option>
                <option value="PG">Papua New Guinea</option>
                <option value="PY">Paraguay</option>
                <option value="PE">Peru</option>
                <option value="PH">Philippines</option>
                <option value="PN">Pitcairn</option>
                <option value="PL">Poland</option>
                <option value="PT">Portugal</option>
                <option value="PR">Puerto Rico</option>
                <option value="QA">Qatar</option>
                <option value="RE">Reunion</option>
                <option value="RO">Romania</option>
                <option value="RU">Russia</option>
                <option value="RW">Rwanda</option>
                <option value="BL">Saint Barthelemy</option>
                <option value="SH">Saint Helena</option>
                <option value="KN">Saint Kitts and Nevis</option>
                <option value="LC">Saint Lucia</option>
                <option value="MF">Saint Martin</option>
                <option value="PM">Saint Pierre and Miquelon</option>
                <option value="VC">Saint Vincent and the Grenadines</option>
                <option value="WS">Samoa</option>
                <option value="SM">San Marino</option>
                <option value="ST">Sao Tome and Principe</option>
                <option value="SA">Saudi Arabia</option>
                <option value="SN">Senegal</option>
                <option value="RS">Serbia</option>
                <option value="CS">Serbia and Montenegro</option>
                <option value="SC">Seychelles</option>
                <option value="SL">Sierra Leone</option>
                <option value="SG">Singapore</option>
                <option value="SX">Sint Maarten</option>
                <option value="SK">Slovakia</option>
                <option value="SI">Slovenia</option>
                <option value="SB">Solomon Islands</option>
                <option value="SO">Somalia</option>
                <option value="ZA">South Africa</option>
                <option value="GS">South Georgia and the South Sandwich Islands</option>
                <option value="KR">South Korea</option>
                <option value="SS">South Sudan</option>
                <option value="ES">Spain</option>
                <option value="LK">Sri Lanka</option>
                <option value="SD">Sudan</option>
                <option value="SR">Suriname</option>
                <option value="SJ">Svalbard and Jan Mayen</option>
                <option value="SZ">Swaziland</option>
                <option value="SE">Sweden</option>
                <option value="CH">Switzerland</option>
                <option value="SY">Syria</option>
                <option value="TW">Taiwan</option>
                <option value="TJ">Tajikistan</option>
                <option value="TZ">Tanzania</option>
                <option value="TH">Thailand</option>
                <option value="TL">Timor-Leste</option>
                <option value="TG">Togo</option>
                <option value="TK">Tokelau</option>
                <option value="TO">Tonga</option>
                <option value="TT">Trinidad and Tobago</option>
                <option value="TN">Tunisia</option>
                <option value="TR">Turkey</option>
                <option value="TM">Turkmenistan</option>
                <option value="TC">Turks and Caicos Islands</option>
                <option value="TV">Tuvalu</option>
                <option value="UG">Uganda</option>
                <option value="UA">Ukraine</option>
                <option value="AE">United Arab Emirates</option>
                <option value="GB">United Kingdom</option>
                <option value="US">United States</option>
                <option value="UM">United States Minor Outlying Islands</option>
                <option value="UY">Uruguay</option>
                <option value="UZ">Uzbekistan</option>
                <option value="VU">Vanuatu</option>
                <option value="VA">Vatican City</option>
                <option value="VE">Venezuela</option>
                <option value="VN">Vietnam</option>
                <option value="VG">Virgin Islands, British</option>
                <option value="VI">Virgin Islands, U.S.</option>
                <option value="WF">Wallis and Futuna</option>
                <option value="EH">Western Sahara</option>
                <option value="YE">Yemen</option>
                <option value="ZM">Zambia</option>
                <option value="ZW">Zimbabwe</option>
            </select>

            </div>
            <br>
            <div>
                <input id="submit" type="button" value="Submit Guess"></input>
                <br>
                <span id="submit-value" style="font-weight:bold"></span>    
            </div>
            <span id="link-value" style="font-weight:bold"></span>   
            <br>
            <input id="next" type="button" value="Play Next Map"></input>
            <div>
                <h3 id="score">Score: </h3>
                <h3 id="score-value"></h3>    
            </div>
            <div>
                <label id="codeval">Multiplayer Code </label>
                <input id="code" type="text" value="1619"></input>
                <input id="codesub" type="button" value="Submit Code"></input>
            </div>
            <!-- In multiplayer mode, you can generate your own map code and share it to your friends to play the same map. -->
            <!-- <p>Welcome to MapGuessr! Your task is to guess the country shown in the map selection. Streaks of correct answers will increase your score, while incorrect answers reset your score to 0. You may adjust the game mode and movement types with the dropdowns. There is a three-minute time limit for each round. The Daily Challenge can be played each day in the Daily Challenge game mode. Enjoy the game!</p> -->
            
            
        </div>
    </div>   
  </body>
  <script>
    // function replaceString(){ return location.href='sms:&body=Play MapGuessr at https://mapguessr.com and beat my streak of Z!'.replace('Z',document.getElementById('score-value').innerHTML);}
    //const shareData = {title: 'MapGuessr', text: 'Play MapGuessr and beat my streak of Z!'.replace('Z',document.getElementById('score-value').innerHTML), url: 'https://mapguessr.com'};
    //const btn = document.querySelector('#share');
    //btn.addEventListener('click',async() => { try{await navigator.share(shareData); console.log(shareData);}catch(err){console.log(err);}});
    //btn.onclick = async() => { try{await navigator.share(shareData);}catch(err){}}
    const btn = document.getElementById("share");

  // function for web share api
  function webShareAPI(header, description, link) {
    navigator
      .share({
        title: header,
        text: description,
        url: link,
      })
      .then(() => console.log("Successful share"))
      .catch((error) => console.log("Error sharing", error));
  }

  // if (navigator.share) {
  //   // Show button if it supports webShareAPI
  //   //btn.style.display = "block";
  //   btn.addEventListener("click", () =>
  //     webShareAPI("MapGuessr", 'Play MapGuessr and beat my Daily Challenge streak of 0!'.replace('0',document.getElementById('score-value').innerHTML) , 'https://mapguessr.com')
  //   );
  // } else {
  //   // Hide button if it doesn't supports webShareAPI
  //   //btn.style.display = "none";
  //   console.error("Your Browser doesn't support Web Share API");
  // }
  </script>

  <script type="text/javascript">
    
      document.getElementById('next').style.visibility ='hidden';

    const {DeckGL} = deck;

    Math.seed = function(s) {
    return function() {
        s = Math.sin(s) * 10000; return s - Math.floor(s);
    };
};

    function getRandomArbitrary(min, max) {
  return Math.random() * (max - min) + min;
    }

    function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}
//var score = 0;
function newMap(score, data){
  //localStorage.setItem('oldscore', score);

    

    const FULL_DASH_ARRAY = 283;
const WARNING_THRESHOLD = 15;
const ALERT_THRESHOLD = 5;

const COLOR_CODES = {
  info: {
    color: "green"
  },
  warning: {
    color: "orange",
    threshold: WARNING_THRESHOLD
  },
  alert: {
    color: "red",
    threshold: ALERT_THRESHOLD
  }
};

const TIME_LIMIT = 180;
let timePassed = 0;
let timeLeft = TIME_LIMIT;
let timerInterval = null;
let remainingPathColor = COLOR_CODES.info.color;

document.getElementById("app").innerHTML = `
<div class="base-timer">
  <svg class="base-timer__svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
    <g class="base-timer__circle">
      <circle class="base-timer__path-elapsed" cx="50" cy="50" r="45"></circle>
      <path
        id="base-timer-path-remaining"
        stroke-dasharray="283"
        class="base-timer__path-remaining ${remainingPathColor}"
        d="
          M 50, 50
          m -45, 0
          a 45,45 0 1,0 90,0
          a 45,45 0 1,0 -90,0
        "
      ></path>
    </g>
  </svg>
  <span id="base-timer-label" class="base-timer__label">${formatTime(
    timeLeft
  )}</span>
</div>
`;

startTimer();

function onTimesUp() {
  clearInterval(timerInterval);
  text1="Incorrect! The correct answer was: ";document.getElementById('submit-value').innerHTML =text1.concat(data[randrow].name); document.getElementById('score-value').innerHTML=0;
  document.getElementById('link-value').innerHTML= `<a href="https://www.google.com/maps/place/${data[randrow].city},${data[randrow].name}" target="_blank">See Previous City</a>`;
  //newMap(document.getElementById('score-value').innerHTML, data);
  document.getElementById('next').style.visibility ='visible';
}

document.getElementById('next').onclick = function() {
    document.getElementById('submit').style.visibility = 'visible';
    document.getElementById('next').style.visibility = 'hidden';
    newMap(document.getElementById('score-value').innerHTML, data);
}

function startTimer() {
  timerInterval = setInterval(() => {
    timePassed = timePassed += 1;
    timeLeft = TIME_LIMIT - timePassed;
    document.getElementById("base-timer-label").innerHTML = formatTime(
      timeLeft
    );
    setCircleDasharray();
    setRemainingPathColor(timeLeft);

    if (timeLeft === 0) {
      onTimesUp();
    }
  }, 1000);
}

function formatTime(time) {
  const minutes = Math.floor(time / 60);
  let seconds = time % 60;

  if (seconds < 10) {
    seconds = `0${seconds}`;
  }

  return `${minutes}:${seconds}`;
}

function setRemainingPathColor(timeLeft) {
  const { alert, warning, info } = COLOR_CODES;
  if (timeLeft <= alert.threshold) {
    document
      .getElementById("base-timer-path-remaining")
      .classList.remove(warning.color);
    document
      .getElementById("base-timer-path-remaining")
      .classList.add(alert.color);
  } else if (timeLeft <= warning.threshold) {
    document
      .getElementById("base-timer-path-remaining")
      .classList.remove(info.color);
    document
      .getElementById("base-timer-path-remaining")
      .classList.add(warning.color);
  }
}

function calculateTimeFraction() {
  const rawTimeFraction = timeLeft / TIME_LIMIT;
  return rawTimeFraction - (1 / TIME_LIMIT) * (1 - rawTimeFraction);
}

function setCircleDasharray() {
  const circleDasharray = `${(
    calculateTimeFraction() * FULL_DASH_ARRAY
  ).toFixed(0)} 283`;
  document
    .getElementById("base-timer-path-remaining")
    .setAttribute("stroke-dasharray", circleDasharray);
}


    document.getElementById('guess').value='';
    //document.getElementById('score-value').innerHTML=score;
    //console.log(localStorage.getItem('oldscore'));
    if (localStorage.getItem('oldscore')>0){
      document.getElementById('score-value').innerHTML=localStorage.getItem('oldscore');
    }
    else{
      document.getElementById('score-value').innerHTML=score;
    }

     if(localStorage.getItem('difficulty')!=null){
       //console.log(localStorage.getItem('difficulty'));
       document.getElementById('hard').value=localStorage.getItem('difficulty');
     }
    

    
    if (Number(document.getElementById('code').value)>=0){
        seed2 = Number(document.getElementById('code').value);
    }
    
    let randrow=0;

    if (Number(document.getElementById('hard').value)==11.1){
        btn.style.display="none";
        // if(navigator.share){btn.style.display = "block";}else{btn.style.display = "none";}
        document.getElementById('code').style.visibility = 'hidden';
        document.getElementById('codeval').style.visibility = 'hidden';
        document.getElementById('codesub').style.visibility = 'hidden';
        document.getElementById('score').style.visibility = 'hidden';
        document.getElementById('score-value').style.visibility = 'hidden';
        //document.getElementById('code').style.visibility = 'visible';
        //document.getElementById('codeval').style.visibility = 'visible';
        //document.getElementById('codesub').style.visibility = 'visible';
        // function convertDateToUTC(date) { 
        //     return new Date(date.getUTCFullYear(), date.getUTCMonth(), date.getUTCDate(), date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds()); 
        // }

        var today = new Date();
        //today = convertDateToUTC(today)
        var dd = String(today.getDate()).padStart(2, '0');
        var mm = String(today.getMonth() + 1).padStart(2, '0');
        var yyyy = today.getFullYear();
        today = mm + dd + yyyy;
        today=Number(today);
        var random1 = Math.seed(Number(today));
        var random = Math.seed(random1());
        randrow = Math.floor(random()*25492)+1;
        //console.log(seed2);
        


    }
    // else if (Number(document.getElementById('hard').value)==14.1){
    //     document.getElementById('code').style.visibility = 'visible';
    //     document.getElementById('codeval').style.visibility = 'visible';
    //     document.getElementById('codesub').style.visibility = 'visible';
    //     var random1 = Math.seed(Number(document.getElementById('code').value));
    //     var random2 = Math.seed(random1());
    //     var random = Math.seed(random2());
    //     randrow = Math.floor(random()*25492)+1;
    //     //console.log(seed2);
        


    // }
    // else if (Number(document.getElementById('hard').value)==16.1){
    //     document.getElementById('code').style.visibility = 'visible';
    //     document.getElementById('codeval').style.visibility = 'visible';
    //     document.getElementById('codesub').style.visibility = 'visible';
    //     var random1 = Math.seed(Number(document.getElementById('code').value));
    //     var random2 = Math.seed(random1());
    //     var random3 = Math.seed(random2());
    //     var random = Math.seed(random3());
    //     randrow = Math.floor(random()*25492)+1;
    //     //console.log(seed2);
        


    // }
    // else if (Number(document.getElementById('hard').value)==18.1){
    //     document.getElementById('code').style.visibility = 'visible';
    //     document.getElementById('codeval').style.visibility = 'visible';
    //     document.getElementById('codesub').style.visibility = 'visible';
    //     var random1 = Math.seed(Number(document.getElementById('code').value));
    //     var random2 = Math.seed(random1());
    //     var random3 = Math.seed(random2());
    //     var random4 = Math.seed(random3());
    //     var random = Math.seed(random4());
    //     randrow = Math.floor(random()*25492)+1;
    //     //console.log(seed2);
        


    // }
    // else if (Number(document.getElementById('hard').value)==19.1){
    //     document.getElementById('code').style.visibility = 'visible';
    //     document.getElementById('codeval').style.visibility = 'visible';
    //     document.getElementById('codesub').style.visibility = 'visible';
    //     var random1 = Math.seed(Number(document.getElementById('code').value));
    //     var random2 = Math.seed(random1());
    //     var random3 = Math.seed(random2());
    //     var random4 = Math.seed(random3());
    //     var random5 = Math.seed(random4());
    //     var random = Math.seed(random5());
    //     randrow = Math.floor(random()*25492)+1;
    //     //console.log(seed2);
        


    // }
    else{
        document.getElementById('code').style.visibility = 'hidden';
        document.getElementById('codeval').style.visibility = 'hidden';
        document.getElementById('codesub').style.visibility = 'hidden';
        document.getElementById('score').style.visibility = 'visible';
        document.getElementById('score-value').style.visibility = 'visible';
        btn.style.display = "none";

    

        //console.log(data);
        randrow = Math.floor(getRandomArbitrary(0, 25493));
        
        
    
    }
    const lon = Number(data[randrow].lon);
    const lat = Number(data[randrow].lat);


    

    
    //console.log(lon, lat);
    //const lon = getRandomArbitrary(-10.04,37);
    //const lat = getRandomArbitrary(29,61);
    //const lon = getRandomArbitrary(-180,180);
    //const lat = getRandomArbitrary(-90,90);


    if (Number(document.getElementById('hard').value)<20){
        document.getElementById('reset').style.visibility = 'visible';
        document.getElementById('move').style.visibility = 'visible';
        document.getElementById('movelabel').style.visibility = 'visible';
        if (Number(document.getElementById('move').value)==1){

    

        const deckgl = new DeckGL({
        mapStyle: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
        //mapStyle: 'https://tiles.basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
        initialViewState: {
            longitude: lon,
            latitude: lat,
            //zoom: 17,
            //minZoom: 17,
            zoom: Number(document.getElementById('hard').value),
            minZoom: Number(document.getElementById('hard').value),
            maxZoom: 24,
            pitch: 0,
            bearing: 0
        },
        controller: {dragPan: true}
        });}

        else if (Number(document.getElementById('move').value)==2){

            const deckgl = new DeckGL({
        mapStyle: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
        initialViewState: {
            longitude: lon,
            latitude: lat,
            //zoom: 17,
            //minZoom: 17,
            zoom: Number(document.getElementById('hard').value),
            minZoom: Number(document.getElementById('hard').value),
            maxZoom: Number(document.getElementById('hard').value),
            pitch: 0,
            bearing: 0
        },
        controller: {dragPan: true}
        });
            



        }
        else{
            const deckgl = new DeckGL({
        mapStyle: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
        initialViewState: {
            longitude: lon,
            latitude: lat,
            //zoom: 17,
            //minZoom: 17,
            zoom: Number(document.getElementById('hard').value),
            minZoom: Number(document.getElementById('hard').value),
            maxZoom: 24,
            pitch: 0,
            bearing: 0
        },
        controller: {dragPan: false}
        });




        }





}else{
    document.getElementById('reset').style.visibility = 'hidden';
    document.getElementById('move').style.visibility = 'hidden';
        document.getElementById('movelabel').style.visibility = 'hidden';
    mapboxgl.accessToken = 'pk.eyJ1IjoidHNhbnRhbmFtIiwiYSI6ImNsMHF0MWs3bjFycm4zY3Rrb2IyaHZ1MXEifQ.trY9YSU4YQzlm9n8wFMVUQ';
    const map = new mapboxgl.Map({
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [lon, lat],
        zoom: Number(document.getElementById('hard').value),
        minZoom: Number(document.getElementById('hard').value),
        pitch: 85,
        logoPosition:'top-right',
        bearing: 0,
        container: 'body',
        antialias: true
    });

    map.on('load', () => {
        // Insert the layer beneath any symbol layer.
        const layers = map.getStyle().layers;
        const labelLayerId = layers.find(
            (layer) => layer.type === 'symbol' && layer.layout['text-field']
        ).id;

        // The 'building' layer in the Mapbox Streets
        // vector tileset contains building height data
        // from OpenStreetMap.
        map.addLayer(
            {
                'id': 'add-3d-buildings',
                'source': 'composite',
                'source-layer': 'building',
                'filter': ['==', 'extrude', 'true'],
                'type': 'fill-extrusion',
                'minzoom': Number(document.getElementById('hard').value),
                'paint': {
                    'fill-extrusion-color': '#aaa',

                    // Use an 'interpolate' expression to
                    // add a smooth transition effect to
                    // the buildings as the user zooms in.
                    'fill-extrusion-height': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        15,
                        0,
                        15.05,
                        ['get', 'height']
                    ],
                    'fill-extrusion-base': [
                        'interpolate',
                        ['linear'],
                        ['zoom'],
                        15,
                        0,
                        15.05,
                        ['get', 'min_height']
                    ],
                    'fill-extrusion-opacity': 1
                }
            },
            labelLayerId
        );
    });
}


    /*
    var ans1=[];
    const geocodingUrl = `http://api.geonames.org/findNearbyPlaceNameJSON?lat=${lat}&lng=${lon}&username=tsantanam`;
    fetch(geocodingUrl).then(result => result.json()).then(featureCollection => {
        
        //console.log(featureCollection);
        const foundAddress = featureCollection.geonames[0];
        const ans = foundAddress.countryName
        ans1.push(ans);

    
    });
    sleep(4000).then(() => {   console.log(ans1[0]);
        if (ans1[0]==null){
            newMap(document.getElementById('score-value').innerHTML);
        }
        document.getElementById('submit').onclick = function() {
    if(document.getElementById('guess').value==ans1[0]){document.getElementById('submit-value').innerHTML = 'Correct!'; var score = Number(document.getElementById('score-value').innerHTML) + 1; console.log(score);document.getElementById('score-value').innerHTML=score;}
    else{text1="Incorrect! The correct answer was: ";document.getElementById('submit-value').innerHTML =text1.concat(ans1[0]); document.getElementById('score-value').innerHTML=0;}
    newMap(document.getElementById('score-value').innerHTML);
}
    
    
    
    });
    

    
    var ans1=[];
    const geocodingUrl = `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`;
    fetch(geocodingUrl).then(result => result.json()).then(featureCollection => {
      //console.log(featureCollection);  
      const foundAddress = featureCollection;
      const ans = foundAddress.countryName;
      ans1.push(ans);
    });
    */
    //var ans1=[];
    /*
    const geocodingUrl = `https://api.geoapify.com/v1/geocode/reverse?lat=${lat}&lon=${lon}&apiKey=${myAPIKey}`;
      fetch(geocodingUrl).then(result => result.json()).then(featureCollection => {
      const foundAddress = featureCollection.features[0];
      const ans = foundAddress.properties.country
      ans1.push(ans);
    });
   */

    sleep(10).then(() => {   //console.log(data[randrow].country);
        if (data[randrow].country==null){
            newMap(document.getElementById('score-value').innerHTML, data);
        }
        document.getElementById('hard').oninput = function(){localStorage.setItem('difficulty', document.getElementById('hard').value); document.getElementById('score-value').innerHTML=0; localStorage.setItem('oldscore', 0); clearInterval(timerInterval); document.getElementById('next').style.visibility ='hidden'; document.getElementById('submit').style.visibility ='visible';newMap(document.getElementById('score-value').innerHTML, data);}
        document.getElementById('move').oninput = function(){document.getElementById('score-value').innerHTML=0; localStorage.setItem('oldscore', 0); clearInterval(timerInterval); document.getElementById('next').style.visibility ='hidden';document.getElementById('submit').style.visibility ='visible';newMap(document.getElementById('score-value').innerHTML, data);}
        document.getElementById('reset').onclick = function() {if (Number(document.getElementById('move').value)==1){

    

const deckgl = new DeckGL({
mapStyle: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
initialViewState: {
    longitude: lon,
    latitude: lat,
    //zoom: 17,
    //minZoom: 17,
    zoom: Number(document.getElementById('hard').value),
    minZoom: Number(document.getElementById('hard').value),
    maxZoom: 24,
    pitch: 0,
    bearing: 0
},
controller: {dragPan: true}
});}

else if (Number(document.getElementById('move').value)==2){

    const deckgl = new DeckGL({
mapStyle: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
initialViewState: {
    longitude: lon,
    latitude: lat,
    //zoom: 17,
    //minZoom: 17,
    zoom: Number(document.getElementById('hard').value),
    minZoom: Number(document.getElementById('hard').value),
    maxZoom: Number(document.getElementById('hard').value),
    pitch: 0,
    bearing: 0
},
controller: {dragPan: true}
});
    



}
else{
    const deckgl = new DeckGL({
mapStyle: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
initialViewState: {
    longitude: lon,
    latitude: lat,
    //zoom: 17,
    //minZoom: 17,
    zoom: Number(document.getElementById('hard').value),
    minZoom: Number(document.getElementById('hard').value),
    maxZoom: 24,
    pitch: 0,
    bearing: 0
},
controller: {dragPan: false}
});




}}
        document.getElementById('submit').onclick = function() {
          
          localStorage.setItem('difficulty', document.getElementById('hard').value);
          document.getElementById('submit').style.visibility = 'hidden';
    if(document.getElementById('guess').value==data[randrow].country){document.getElementById('submit-value').innerHTML = 'Correct!'; var score = Number(document.getElementById('score-value').innerHTML) + 1; document.getElementById('score-value').innerHTML=score;clearInterval(timerInterval);}
    else{text1="Incorrect! The correct answer was: ";document.getElementById('submit-value').innerHTML =text1.concat(data[randrow].name); document.getElementById('score-value').innerHTML=0;clearInterval(timerInterval);}
    
    localStorage.setItem('oldscore', score);
    
    document.getElementById('link-value').innerHTML= `<a href="https://www.google.com/maps/place/${data[randrow].city},${data[randrow].name}" target="_blank">See Previous City</a>`;
    //newMap(document.getElementById('score-value').innerHTML, data);
    if (Number.isInteger(Number(document.getElementById('hard').value))){document.getElementById('next').style.visibility ='visible';}

    if(Number(document.getElementById('hard').value)==11.1){
            if (navigator.share) {
    // Show button if it supports webShareAPI
    btn.style.display = "block";
    if(Number(document.getElementById('score-value').innerHTML)>0){
      btn.addEventListener("click", () =>
      webShareAPI("MapGuessr", 'I solved today\'s MapGuessr Daily Challenge! Can you? 🌎🗾' , 'https://mapguessr.com')
    );
    }else{btn.addEventListener("click", () =>
      webShareAPI("MapGuessr", 'I couldn\'t solve today\'s MapGuessr Daily Challenge! Can you? 🌎🗾' , 'https://mapguessr.com')
    );}
    
  } else {
    // Hide button if it doesn't supports webShareAPI
    //btn.style.display = "none";
    console.error("Your Browser doesn't support Web Share API");
  }
          }
    

}

    document.getElementById('codesub').onclick=function(){
        document.getElementById('score-value').innerHTML=0; clearInterval(timerInterval); newMap(document.getElementById('score-value').innerHTML, data);
    }
    
    
    
    });
    

}

document.getElementById('guess').value='';
//alert("Welcome to MapGuessr! You will be shown a section of a map. You may zoom in and pan around. Your task is to guess the country shown in the center of the map selection. You can select the country name in the dropdown field and then click submit to see if you were correct or incorrect. Streaks of correct answers will increase your score, while incorrect answers reset your score to 0. You may adjust the difficulty level with the difficulty dropdown. Street Mode is a 3D map mode with buildings. There is a two-minute time limit for each round. Enjoy the game!");
d3.dsv(",", "cities.csv", function (d) {
      return {
        // format data attributes if required
        lat: d.e,
        lon: d.f,
        country: d.i,
        name: d.t,
        city: d.c
      }
    }).then(function (data) {
      //console.log(data);
      // if (localStorage.getItem('oldscore')==null){
      //   newMap(0, data);
      // }
      // else{
      //   newMap(localStorage.getItem('oldscore'), data);
      // }
        newMap(0, data);
    });


  </script>
</html>
